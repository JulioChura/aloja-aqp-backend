<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Prueba Google Login + JWT</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <h1>Login con Google</h1>

    <div class="g_id_signin"></div>

    <script>
        function handleCredentialResponse(response) {
            console.log("üí° ID Token recibido de Google:", response.credential);

            if (!response.credential) {
                console.error("‚ùå No se recibi√≥ ning√∫n ID Token de Google");
                alert("Error: no se recibi√≥ ID Token de Google");
                return;
            }

            // Mensaje de depuraci√≥n antes de enviar al backend
            console.log("üí° Enviando ID Token al backend...");

            fetch('http://127.0.0.1:8000/api/auth/google-login/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id_token: response.credential
                })
            })
            .then(res => {
                console.log("üí° Respuesta HTTP del backend:", res.status, res.statusText);
                return res.json();
            })
            .then(data => {
                console.log("üí° Datos recibidos del backend:", data);
                if (data.access) {
                    localStorage.setItem('access_token', data.access);
                    localStorage.setItem('refresh_token', data.refresh);
                    alert('‚úÖ Login exitoso! JWT guardado en localStorage.');
                } else if (data.error) {
                    console.error("‚ùå Error en el login con Google:", data.error);
                    alert("Error en el login con Google: " + data.error);
                } else {
                    console.warn("‚ö†Ô∏è Respuesta inesperada del backend", data);
                    alert("Error inesperado en el login con Google");
                }
            })
            .catch(err => {
                console.error("‚ùå Error al comunicarse con el backend:", err);
                alert("Error al comunicarse con el backend");
            });
        }

        window.onload = function () {
            console.log("üí° Inicializando Google Sign-In...");
            google.accounts.id.initialize({
                client_id: "1039102089143-lo6vj6hk3ro3ih.apps.googleusercontent.com",
                callback: handleCredentialResponse
            });
            google.accounts.id.renderButton(
                document.querySelector(".g_id_signin"),
                { theme: "outline", size: "large" }
            );
            google.accounts.id.prompt(); // Para mostrar el prompt autom√°ticamente si se desea
        };
    </script>
</body>
</html>
